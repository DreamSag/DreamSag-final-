<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamSag - Register</title>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root { --primary: #0866ff; --bg: #f0f2f5; --accent: #00c6ff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        
        .card { 
            background: white; padding: 35px 25px; border-radius: 30px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); width: 100%; 
            max-width: 380px; text-align: center; border: 1px solid #fff;
        }
        
        .brand { 
            font-size: 36px; font-weight: 900; margin-bottom: 10px; 
            letter-spacing: -1px; color: var(--primary); 
        }
        .brand span { color: var(--accent); }

        .subtitle { color: #65676b; font-size: 14px; margin-bottom: 25px; font-weight: 600; }

        .input-box { position: relative; margin-bottom: 15px; }
        .input-box i { position: absolute; left: 15px; top: 15px; color: #8a8d91; }
        
        input { 
            width: 100%; padding: 14px 14px 14px 45px; border: 2px solid #f0f2f5; 
            border-radius: 15px; box-sizing: border-box; outline: none; 
            transition: 0.3s; font-size: 15px; background: #f9fafb;
        }
        input:focus { border-color: var(--primary); background: #fff; box-shadow: 0 0 0 4px rgba(8,102,255,0.1); }

        .btn { 
            background: linear-gradient(135deg, var(--primary), var(--accent)); 
            color: white; border: none; width: 100%; padding: 16px; 
            border-radius: 15px; cursor: pointer; font-weight: 800; 
            font-size: 16px; margin-top: 15px; transition: 0.3s;
            box-shadow: 0 8px 20px rgba(8,102,255,0.3);
        }
        .btn:active { transform: scale(0.97); }

        .footer-link { margin-top: 25px; display: block; color: #65676b; text-decoration: none; font-size: 14px; font-weight: 600; }
        .footer-link span { color: var(--primary); font-weight: 800; }

        #ref-msg { 
            font-size: 12px; color: #28a745; font-weight: 800; 
            margin-bottom: 15px; background: #e7f7ed; padding: 10px; 
            border-radius: 12px; display: none; border: 1px solid #d4edda;
        }
    </style>
</head>
<body>

<div class="card">
    <div class="brand">DREAM<span>SAG</span></div>
    <div class="subtitle">Join the future of investment</div>
    
    <div id="ref-msg"></div>
    
    <div class="input-box">
        <i class="fas fa-envelope"></i>
        <input type="email" id="reg-email" placeholder="Email Address">
    </div>

    <div class="input-box">
        <i class="fas fa-lock"></i>
        <input type="password" id="reg-pass" placeholder="Password (Min 6 chars)">
    </div>
    
    <button class="btn" id="reg-btn">Create Account <i class="fas fa-arrow-right" style="margin-left:8px;"></i></button>
    
    <a href="index.html" class="footer-link">Already have an account? <span>Login</span></a>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAab16yXGrK5CfUPZ57JgQ_3OxbtXReibY",
        authDomain: "dreamsag-17ed9.firebaseapp.com",
        projectId: "dreamsag-17ed9",
        databaseURL: "https://dreamsag-17ed9-default-rtdb.firebaseio.com/",
        appId: "1:414865998660:web:5b81b4249ff9e359594d11"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // Referral Check
    const urlParams = new URLSearchParams(window.location.search);
    const referrerId = urlParams.get('ref') || "direct";

    if (referrerId !== "direct") {
        const msgBox = document.getElementById('ref-msg');
        msgBox.style.display = "block";
        msgBox.innerHTML = '<i class="fas fa-link"></i> Referral Active';
    }

    document.getElementById('reg-btn').onclick = function() {
        const email = document.getElementById('reg-email').value.trim();
        const pass = document.getElementById('reg-pass').value;
        const btn = this;

        // Validation with SweetAlert2
        if (!email || !email.includes("@")) {
            return Swal.fire('Invalid Email', 'Please enter a valid email address.', 'warning');
        }
        if (pass.length < 6) {
            return Swal.fire('Weak Password', 'Password must be at least 6 characters.', 'warning');
        }

        // Show Loading
        Swal.fire({
            title: 'Creating Account...',
            text: 'Please wait a moment',
            allowOutsideClick: false,
            didOpen: () => { Swal.showLoading(); }
        });

        createUserWithEmailAndPassword(auth, email, pass)
            .then((userCredential) => {
                const user = userCredential.user;
                set(ref(db, 'users/' + user.uid), {
                    email: email,
                    totalBalance: 0,
                    dailyEarnings: 0,
                    activePlanId: 0,
                    referredBy: referrerId,
                    joinDate: new Date().toISOString(), // Standard format for better sorting
                    lastProfitTime: 0,
                    spinCount: 0 // New users start with 0 spins
                }).then(() => {
                    Swal.fire({
                        icon: 'success',
                        title: 'Welcome!',
                        text: 'Registration successful. Let\'s get started!',
                        confirmButtonColor: '#0866ff'
                    }).then(() => {
                        window.location.href = "dashboard.html";
                    });
                });
            })
            .catch((error) => {
                let msg = "Something went wrong.";
                if(error.code === 'auth/email-already-in-use') msg = "This email is already registered.";
                
                Swal.fire('Registration Failed', msg, 'error');
                btn.disabled = false;
            });
    }
</script>
</body>
</html>
